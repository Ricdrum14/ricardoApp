import{a as A,b as rt,c as jt,d as Rt,e as Ut,f as Gt,g as Ht,h as lt,i as D,j as zt,k as pe,l as $t,m as Ae,n as Bt,p as Wt,q as Ne,r as Le,s as ne,t as Ve,u as je,v as N}from"./chunk-MGOYXZT6.js";import{$ as Xe,$a as Ot,A as ft,Aa as C,B as ue,Ba as it,Ca as me,D as ce,Da as R,E as gt,Ea as ot,F as Y,Fa as ee,G as ht,Ga as te,H as g,Ja as Et,K as y,L as vt,Ma as Ce,N as xt,Na as Se,Oa as S,Pa as Pt,Q as _t,Qa as ie,R as h,Ra as E,S as v,Sa as nt,T as be,Ta as kt,U as bt,Ua as Mt,Va as It,W as yt,Xa as Ft,Y as Q,Ya as U,Za as oe,_a as Dt,a as V,aa as O,ab as Ee,b as xe,ba as s,bb as Tt,c as j,ca as T,cb as G,db as _,e as ae,ea as f,eb as H,fa as u,fb as Pe,ga as Ze,h as _e,ha as r,hb as ke,i as pt,ia as n,ib as Me,ja as m,jb as At,ka as et,kb as Ie,l as se,la as tt,lb as Fe,m as Je,ma as w,mb as Nt,na as p,nb as Lt,o as B,oa as c,ob as Vt,pa as wt,qa as Ct,ra as St,s as de,sa as ye,sb as De,ta as a,tb as Oe,ua as we,ub as Te,va as x,vb as fe,wa as F,wb as Kt,xa as J,ya as X,za as Z}from"./chunk-NHHM44B2.js";var ni=i=>({"rotate-180":i});function ri(i,t){if(i&1){let e=w();r(0,"div",13),m(1,"div",14),r(2,"a",15),p("click",function(){h(e);let l=c(2);return v(l.isMenuOpen=!1)}),m(3,"img",16),r(4,"span"),a(5,"Mon compte"),n()(),r(6,"button",17),p("click",function(){h(e);let l=c(2);return l.logout(),v(l.isMenuOpen=!1)}),m(7,"img",18),r(8,"span"),a(9),n()()()}if(i&2){let e=c(2);s(6),u("disabled",e.isLoading()),s(3),we(e.isLoading()?"D\xE9connexion...":"D\xE9connexion")}}function li(i,t){if(i&1){let e=w();r(0,"div",6),p("keydown.escape",function(){h(e);let l=c();return v(l.isMenuOpen=!1)}),r(1,"div",7),p("click",function(){h(e);let l=c();return v(l.toggleMenu())}),m(2,"img",8),r(3,"span",9),a(4),n(),be(),r(5,"svg",10),m(6,"path",11),n()(),f(7,ri,10,2,"div",12),n()}if(i&2){let e=c();s(2),u("src","https://api.dicebear.com/8.x/initials/svg?seed="+e.currentUser().prenom+" "+e.currentUser().nom,O),s(2),F(" ",e.currentUser().prenom," ",e.currentUser().nom," "),s(),u("ngClass",me(5,ni,e.isMenuOpen)),s(2),u("ngIf",e.isMenuOpen)}}function ai(i,t){i&1&&(r(0,"button",19),a(1," Se Connecter "),n())}function si(i,t){i&1&&(r(0,"button",19),a(1," Se Connecter "),n())}function di(i,t){if(i&1){let e=w();r(0,"div",20),m(1,"img",21),r(2,"p",22),a(3),n(),r(4,"a",23),a(5," Mon compte "),n(),r(6,"button",24),p("click",function(){h(e);let l=c();return v(l.logout())}),a(7),n()()}if(i&2){let e=c();s(),u("src","https://api.dicebear.com/8.x/initials/svg?seed="+e.currentUser().prenom,O),s(2),F(" ",e.currentUser().prenom," ",e.currentUser().nom," "),s(3),u("disabled",e.isLoading()),s(),x(" ",e.isLoading()?"\u23F3 D\xE9connexion...":"D\xE9connexion"," ")}}function ui(i,t){i&1&&(r(0,"div",20)(1,"button",25),a(2," Se Connecter "),n(),r(3,"button",26),a(4," Cr\xE9er un compte "),n()())}var Re=class i{store=g(D);isMenuOpen=!1;isConnected=A(this.store.select(N.isConnected),{initialValue:!1});currentUser=A(this.store.select(N.currentUser),{initialValue:null});isLoading=A(this.store.select(N.isLoading),{initialValue:!1});error=A(this.store.select(N.error),{initialValue:null});ngOnInit(){this.store.dispatch(new Ne)}toggleMenu(){this.isMenuOpen=!this.isMenuOpen}logout(){this.store.dispatch(new Wt),this.isMenuOpen=!1}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-connexion"]],standalone:!0,features:[C],decls:8,vars:4,consts:[["notLogged",""],[1,"hidden","md:flex","items-center"],["class","relative ml-3",3,"keydown.escape",4,"ngIf"],["routerLink","/login","class","btn-login",4,"ngIf"],[1,"md:hidden","w-full"],["class","flex flex-col items-center gap-3 mt-3",4,"ngIf"],[1,"relative","ml-3",3,"keydown.escape"],[1,"flex","items-center","gap-3","bg-white/15","px-5","py-2","rounded-full","backdrop-blur-md","shadow-sm","border","border-white/30","cursor-pointer","select-none","hover:bg-white/25","transition",3,"click"],["alt","Avatar",1,"w-9","h-9","rounded-full","border","border-white","shadow-sm","flex-shrink-0",3,"src"],[1,"text-white","font-medium","text-sm","tracking-wide"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4","text-white","transition-transform","duration-200",3,"ngClass"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],["class","absolute right-0 mt-3 w-48 bg-white rounded-xl shadow-xl border border-gray-200 z-50 origin-top-right animate-fadeIn",4,"ngIf"],[1,"absolute","right-0","mt-3","w-48","bg-white","rounded-xl","shadow-xl","border","border-gray-200","z-50","origin-top-right","animate-fadeIn"],[1,"absolute","-top-2","right-6","w-3","h-3","bg-white","rotate-45","border-l","border-t","border-gray-200"],["routerLink","/profil",1,"menu-link","account","px-4","py-2","rounded-t-xl","flex","items-center","gap-2",3,"click"],["src","assets/images/connecte.svg","alt","Ic\xF4ne utilisateur connect\xE9",1,"w-5","h-5"],[1,"menu-link","logout","w-full","text-left","px-4","py-2","rounded-b-xl","flex","items-center","gap-2",3,"click","disabled"],["src","assets/images/deconnecte.svg","alt","Ic\xF4ne d\xE9connexion",1,"w-5","h-5"],["routerLink","/login",1,"btn-login"],[1,"flex","flex-col","items-center","gap-3","mt-3"],["alt","Avatar",1,"w-12","h-12","rounded-full","border","border-white","shadow-md",3,"src"],[1,"text-sm","text-gray-100","font-medium","uppercase","tracking-wide"],["routerLink","/profil",1,"bg-white","text-indigo-700","font-semibold","px-5","py-2","rounded-lg","shadow","hover:bg-gray-100","transition","w-40","text-center"],[1,"bg-red-500","hover:bg-red-600","text-white","font-semibold","px-5","py-2","rounded-lg","shadow","transition","w-40","disabled:opacity-50",3,"click","disabled"],["routerLink","/login",1,"bg-white","text-indigo-700","font-semibold","px-5","py-2","rounded-lg","shadow","hover:bg-gray-100","transition","w-40"],["routerLink","/signup",1,"text-white/90","hover:text-white","underline","underline-offset-4"]],template:function(e,o){e&1&&(r(0,"div",1),f(1,li,8,7,"div",2)(2,ai,2,0,"ng-template",null,0,te)(4,si,2,0,"button",3),n(),r(5,"div",4),f(6,di,8,5,"div",5)(7,ui,5,0,"div",5),n()),e&2&&(s(),u("ngIf",o.isConnected()),s(3),u("ngIf",!o.isConnected()),s(2),u("ngIf",o.isConnected()),s(),u("ngIf",!o.isConnected()))},dependencies:[E,Ce,S,Ee,oe],styles:[".menu-link.account[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#4f46e5;font-weight:600}.menu-link.account[_ngcontent-%COMP%]:hover{background-color:#eef2ff;color:#4338ca}.menu-link.logout[_ngcontent-%COMP%]{border:none;background:transparent}.menu-link.logout[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}.menu-link.logout[_ngcontent-%COMP%]:hover{background-color:#fef2f2;color:#b91c1c}.btn-login[_ngcontent-%COMP%]{background-color:#fff;color:#2563eb;font-weight:600;padding:.5rem 1rem;border-radius:.5rem;box-shadow:0 0 8px #fff6;border:none;cursor:pointer;transition:all .3s ease}.btn-login[_ngcontent-%COMP%]:hover{background-color:#f0f9ff;color:#1e3a8a;transform:translateY(-2px) scale(1.05);box-shadow:0 0 15px #3b82f6b3,0 0 30px #3b82f666}"]})};var b=class{getUserId(){try{return JSON.parse(localStorage.getItem("auth_user")||"{}")?.id?.toString()||"guest"}catch{return"guest"}}addFavorite({patchState:t,getState:e},{payload:o}){let l=e().favorites||[];if(!l.some(d=>d.id===o.id)){let d=[...l,o];t({favorites:d});let k=`favorites_${this.getUserId()}`;localStorage.setItem(k,JSON.stringify(d))}}removeFavorite({patchState:t,getState:e},{payload:o}){let l=(e().favorites||[]).filter(k=>k.id!==o.pollutionId);t({favorites:l});let d=`favorites_${this.getUserId()}`;localStorage.setItem(d,JSON.stringify(l))}clearFavorites({patchState:t}){t({favorites:[]})}loadFavoritesFromStorage({patchState:t}){let e=`favorites_${this.getUserId()}`,o=localStorage.getItem(e);t({favorites:o?JSON.parse(o):[]})}static getFavorites(t){return t.favorites||[]}static getFavoritesCount(t){return(t.favorites||[]).length}static isFavorite(t){return e=>(t.favorites||[]).some(o=>o.id===e)}};j([pe(Le)],b.prototype,"addFavorite",1),j([pe(ne)],b.prototype,"removeFavorite",1),j([pe(Ve)],b.prototype,"clearFavorites",1),j([pe(je)],b.prototype,"loadFavoritesFromStorage",1),j([Ae()],b,"getFavorites",1),j([Ae()],b,"getFavoritesCount",1),j([Ae()],b,"isFavorite",1),b=j([$t({name:"favorites",defaults:{favorites:[]}})],b);var Yt=()=>({exact:!0});function ci(i,t){if(i&1&&(r(0,"span",17),a(1),n()),i&2){let e=c();s(),x(" ",e.favoritesCount()," ")}}function mi(i,t){if(i&1&&(r(0,"span",17),a(1),n()),i&2){let e=c(2);s(),x(" ",e.favoritesCount()," ")}}function pi(i,t){if(i&1){let e=w();r(0,"div",18)(1,"nav",19)(2,"a",20),p("click",function(){h(e);let l=c();return v(l.navigateHome())}),a(3," Accueil "),n(),r(4,"button",21),p("click",function(){h(e);let l=c();return v(l.declarePollution())}),a(5," D\xE9clarer "),n(),r(6,"a",22),a(7," Carte "),n(),r(8,"a",23),a(9," Statistiques "),n(),r(10,"button",13),p("click",function(){h(e);let l=c();return v(l.goToFavorites())}),r(11,"span",14),a(12,"\u2764\uFE0F"),n(),f(13,mi,2,1,"span",15),n(),m(14,"app-connexion"),n()()}if(i&2){let e=c();s(2),u("routerLinkActiveOptions",it(4,Yt)),s(2),Ze("active-action",e.declareActive),s(9),u("ngIf",e.favoritesCount()>0)}}var re=class i{isMenuOpen=!1;searchQuery="";declareActive=!1;goHome=new Q;openDeclareForm=new Q;searchChanged=new Q;router=g(U);store=g(D);favoritesCount=A(this.store.select(b.getFavoritesCount),{initialValue:0});ngOnInit(){}toggleMenu(){this.isMenuOpen=!this.isMenuOpen}onSearchChange(){this.searchChanged.emit(this.searchQuery.trim().toLowerCase())}goLogin(){return ae(this,null,function*(){this.isMenuOpen=!1,yield this.router.navigate(["/login"])})}goSignup(){return ae(this,null,function*(){this.isMenuOpen=!1,yield this.router.navigate(["/signup"])})}navigateHome(){this.isMenuOpen=!1,this.goHome.emit()}declarePollution(){this.isMenuOpen=!1,this.openDeclareForm.emit()}goToFavorites(){if(!this.store.selectSnapshot(N.isConnected)){this.router.navigate(["/login"],{queryParams:{redirect:"/favoris"}});return}this.router.navigate(["/favoris"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-header"]],inputs:{declareActive:"declareActive"},outputs:{goHome:"goHome",openDeclareForm:"openDeclareForm",searchChanged:"searchChanged"},standalone:!0,features:[C],decls:28,vars:8,consts:[[1,"bg-gradient-to-r","from-blue-600","via-indigo-600","to-purple-600","shadow-lg","relative","z-50"],[1,"max-w-7xl","mx-auto","px-6","py-4","flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4","md:gap-6","transition-all","duration-300"],[1,"flex","justify-between","items-center","w-full","md:w-auto"],[1,"text-2xl","font-bold","text-white","tracking-wide","flex","items-center","gap-2","cursor-pointer",3,"click"],[1,"md:hidden","text-white","text-3xl","focus:outline-none",3,"click"],[1,"relative","w-full","md:max-w-lg","order-3","md:order-none","mx-auto","md:mx-0","flex-shrink-0"],["type","text","placeholder","Rechercher une pollution...",1,"w-full","pl-10","pr-4","py-2","rounded-full","bg-white/95","text-gray-700","placeholder-gray-500","shadow-inner","focus:ring-2","focus:ring-green-400","outline-none","transition-all","duration-200",3,"ngModelChange","input","ngModel"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-gray-500","text-lg"],[1,"hidden","md:flex","items-center","space-x-6"],["routerLink","/","routerLinkActive","active-link",1,"text-white","hover:text-gray-200","font-medium","transition",3,"routerLinkActiveOptions"],["type","button",1,"text-white","bg-transparent","hover:text-gray-200","text-lg","font-medium","transition","cursor-pointer",3,"click"],["routerLink","/carte","routerLinkActive","active-link",1,"text-white","hover:text-gray-200","font-medium","transition"],["routerLink","/stats","routerLinkActive","active-link",1,"text-white","hover:text-gray-200","font-medium","transition"],["title","Voir mes favoris",1,"relative","flex","items-center","gap-2","px-4","py-2","rounded-lg","bg-white/20","hover:bg-white/30","text-white","font-medium","transition-all","duration-200",3,"click"],[1,"text-2xl"],["class","absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",4,"ngIf"],["class","md:hidden bg-indigo-700 bg-opacity-95 backdrop-blur-sm text-white border-t border-indigo-500 transition-all duration-300 absolute top-full left-0 w-full z-50",4,"ngIf"],[1,"absolute","-top-2","-right-2","bg-red-500","text-white","text-xs","font-bold","rounded-full","w-5","h-5","flex","items-center","justify-center"],[1,"md:hidden","bg-indigo-700","bg-opacity-95","backdrop-blur-sm","text-white","border-t","border-indigo-500","transition-all","duration-300","absolute","top-full","left-0","w-full","z-50"],[1,"flex","flex-col","items-center","py-4","space-y-3"],["routerLink","/","routerLinkActive","active-link",1,"hover:text-gray-200","text-lg","font-medium","transition","cursor-pointer",3,"click","routerLinkActiveOptions"],["type","button",1,"text-white","hover:text-gray-200","font-medium","transition","cursor-pointer",3,"click"],["routerLink","/carte","routerLinkActive","active-link",1,"hover:text-gray-200","text-lg","font-medium","transition"],["routerLink","/stats","routerLinkActive","active-link",1,"hover:text-gray-200","text-lg","font-medium","transition"]],template:function(e,o){e&1&&(r(0,"header",0)(1,"div",1)(2,"div",2)(3,"h1",3),p("click",function(){return o.navigateHome()}),a(4," \u{1F30D} "),r(5,"span"),a(6,"Pollution Tracker"),n()(),r(7,"button",4),p("click",function(){return o.toggleMenu()}),a(8),n()(),r(9,"div",5)(10,"input",6),Z("ngModelChange",function(d){return X(o.searchQuery,d)||(o.searchQuery=d),d}),p("input",function(){return o.onSearchChange()}),n(),r(11,"span",7),a(12,"\u{1F50D}"),n()(),r(13,"nav",8)(14,"a",9),a(15," Accueil "),n(),r(16,"button",10),p("click",function(){return o.declarePollution()}),a(17," D\xE9clarer "),n(),r(18,"a",11),a(19," Carte "),n(),r(20,"a",12),a(21," Statistiques "),n(),r(22,"button",13),p("click",function(){return o.goToFavorites()}),r(23,"span",14),a(24,"\u2764\uFE0F"),n(),f(25,ci,2,1,"span",15),n(),m(26,"app-connexion"),n()(),f(27,pi,15,5,"div",16),n()),e&2&&(s(8),x(" ",o.isMenuOpen?"\u2716":"\u2630"," "),s(2),J("ngModel",o.searchQuery),s(4),u("routerLinkActiveOptions",it(7,Yt)),s(2),Ze("active-action",o.declareActive),s(9),u("ngIf",o.favoritesCount()>0),s(2),u("ngIf",o.isMenuOpen))},dependencies:[E,S,Oe,G,H,ke,Ee,oe,Dt,Re],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95) translateY(-5px)}to{opacity:1;transform:scale(1) translateY(0)}}.animate-fadeIn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .15s ease-out}img[_ngcontent-%COMP%]{transition:transform .2s ease,opacity .2s ease}a[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%], button[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.1);opacity:.9}.menu-link[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;transition:all .2s ease}.menu-link.account[_ngcontent-%COMP%]{color:#4f46e5}.menu-link.account[_ngcontent-%COMP%]:hover{background-color:#eef2ff;color:#4338ca;transform:scale(1.03)}.menu-link.logout[_ngcontent-%COMP%]{color:#dc2626}.menu-link.logout[_ngcontent-%COMP%]:hover{background-color:#fef2f2;color:#b91c1c;transform:scale(1.03)}.menu-link[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transition:transform .25s ease,opacity .25s ease}.menu-link[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.15);opacity:.9}.active-link[_ngcontent-%COMP%], .active-action[_ngcontent-%COMP%]{color:#fde047;font-weight:600;text-shadow:0 0 6px rgba(253,224,71,.6)}button[_ngcontent-%COMP%]:not(.menu-link){color:#fff;background:transparent;border:none;outline:none}button[_ngcontent-%COMP%]:hover{color:#e5e7eb}.btn-login[_ngcontent-%COMP%]{background-color:#fff;color:#2563eb;font-weight:600;padding:.5rem 1rem;border-radius:.5rem;box-shadow:0 0 8px #fff6;transition:all .3s ease}.btn-login[_ngcontent-%COMP%]:hover{background-color:#f0f9ff;color:#1e3a8a;transform:translateY(-2px) scale(1.05);box-shadow:0 0 15px #3b82f6b3,0 0 30px #3b82f666}"]})};var K=class{constructor(t,e,o,l,d,k,le,qe,he){this.titre=t;this.type=e;this.description=o;this.date=l;this.lieu=d;this.latitude=k;this.longitude=le;this.photo=qe;this.id=he||""}id};var $=class i{constructor(t){this.http=t}apiUrl=fe.backendPollution;isMock=!fe.production;localPollutions=[];pollutionsSubject=new pt([]);pollutions$=this.pollutionsSubject.asObservable();handleError(t,e){return console.error("Une erreur s'est produite:",t),Je(()=>new Error(e))}getPollutions(){return this.localPollutions.length===0?this.http.get(this.apiUrl).pipe(B(t=>t.map(e=>new K(e.titre,e.type_pollution||e.type,e.description,new Date(e.date_observation||e.date),e.lieu,e.latitude,e.longitude,e.photo_url||e.photo,e.id))),ue(t=>{this.localPollutions=t,this.pollutionsSubject.next(t)})):this.pollutions$}getPollutionById(t){if(this.isMock){let e=this.localPollutions.find(o=>o.id===t);return e?se(e):Je(()=>new Error("Pollution non trouv\xE9e"))}else return this.http.get(`${this.apiUrl}/${t}`).pipe(B(e=>{if(!e)throw new Error("Pollution non trouv\xE9e");return new K(e.titre,e.type_pollution||e.type,e.description,new Date(e.date_observation||e.date),e.lieu,e.latitude,e.longitude,e.photo_url||e.photo,e.id)}),de(e=>this.handleError(e,"Impossible de r\xE9cup\xE9rer la pollution.")))}addPollution(t){let e=typeof t.photo=="string"&&t.photo.startsWith("data:"),o={titre:t.titre,lieu:t.lieu,date_observation:new Date(t.date).toISOString(),type_pollution:t.type,description:t.description,latitude:t.latitude,longitude:t.longitude,photo_url:e?null:t.photo};return this.isMock?(this.localPollutions.push(t),this.pollutionsSubject.next([...this.localPollutions]),console.log("\u2705 Pollution ajout\xE9e (mock) :",t),se(t)):this.http.post(this.apiUrl,o).pipe(B(l=>{let d=new K(l.titre,l.type_pollution||l.type,l.description,new Date(l.date_observation||l.date),l.lieu,l.latitude,l.longitude,l.photo_url||l.photo,l.id);return this.localPollutions.push(d),this.pollutionsSubject.next([...this.localPollutions]),d}),de(l=>this.handleError(l,"Erreur lors de la cr\xE9ation de la pollution.")))}updatePollution(t){if(this.isMock){let e=this.localPollutions.findIndex(o=>o.id===t.id);return e!==-1&&(this.localPollutions[e]=t),this.pollutionsSubject.next([...this.localPollutions]),se(t)}else{let e={titre:t.titre,lieu:t.lieu,date_observation:new Date(t.date).toISOString(),type_pollution:t.type,description:t.description,latitude:t.latitude,longitude:t.longitude,photo_url:typeof t.photo=="string"&&t.photo.startsWith("data:")?null:t.photo};return this.http.put(`${this.apiUrl}/${t.id}`,e).pipe(B(o=>{let l=o.data||o,d=new K(l.titre,l.type_pollution||l.type,l.description,new Date(l.date_observation||l.date),l.lieu,l.latitude,l.longitude,l.photo_url||l.photo,l.id),k=this.localPollutions.findIndex(le=>le.id===d.id);return k!==-1?this.localPollutions[k]=d:this.localPollutions.push(d),this.pollutionsSubject.next([...this.localPollutions]),d}),de(o=>this.handleError(o,"Erreur lors de la mise \xE0 jour de la pollution.")))}}deletePollution(t){return this.isMock?(this.localPollutions=this.localPollutions.filter(e=>e.id!==t),this.pollutionsSubject.next([...this.localPollutions]),se({message:"La pollution a \xE9t\xE9 supprim\xE9e avec succ\xE8s."})):this.http.delete(`${this.apiUrl}/${t}`).pipe(ue(()=>{this.localPollutions=this.localPollutions.filter(e=>e.id!==t),this.pollutionsSubject.next([...this.localPollutions])}),de(e=>this.handleError(e,"Impossible de supprimer la pollution.")))}static \u0275fac=function(e){return new(e||i)(ht(kt))};static \u0275prov=ce({token:i,factory:i.\u0275fac,providedIn:"root"})};function fi(i,t){if(i&1){let e=w();r(0,"div",11)(1,"form",12),p("ngSubmit",function(){h(e);let l=c();return v(l.saveChanges())}),r(2,"div",13)(3,"div")(4,"label",14),a(5,"Titre"),n(),m(6,"input",15),n(),r(7,"div")(8,"label",14),a(9,"Type"),n(),m(10,"input",16),n()(),r(11,"div")(12,"label",14),a(13,"Description"),n(),m(14,"textarea",17),n(),r(15,"div",13)(16,"div")(17,"label",14),a(18,"Latitude"),n(),m(19,"input",18),n(),r(20,"div")(21,"label",14),a(22,"Longitude"),n(),m(23,"input",19),n()(),r(24,"button",20),a(25," \u{1F4BE} Enregistrer "),n()()()}if(i&2){let e=c();s(),u("formGroup",e.form)}}var Ue=class i{constructor(t,e){this.fb=t;this.pollutionService=e}_pollution;set pollution(t){this._pollution=t,this.form&&t&&this.updateForm(t)}get pollution(){return this._pollution}editMode=!1;form;destroy$=new _e;successMessage="";ngOnInit(){this.initForm()}initForm(){this.form=this.fb.group({titre:[this.pollution.titre],type:[this.pollution.type],description:[this.pollution.description],date:[this.pollution.date],lieu:[this.pollution.lieu],latitude:[this.pollution.latitude],longitude:[this.pollution.longitude],photo:[this.pollution.photo]})}updateForm(t){this.form?this.form.patchValue({titre:t.titre,type:t.type,description:t.description,date:t.date,lieu:t.lieu,latitude:t.latitude,longitude:t.longitude,photo:t.photo}):this.initForm()}toggleEdit(){this.editMode=!this.editMode,this.successMessage=""}saveChanges(){let t=V(V({},this.pollution),this.form.value);this.pollutionService.updatePollution(t).pipe(ft(this.destroy$)).subscribe({next:e=>{this.pollution=e,this.form.patchValue(e),this.editMode=!1,this.successMessage="\u2705 Pollution mise \xE0 jour avec succ\xE8s !",setTimeout(()=>this.successMessage="",3e3)},error:e=>console.error("Erreur lors de la mise \xE0 jour :",e)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||i)(T(De),T($))};static \u0275cmp=y({type:i,selectors:[["app-pollution-details"]],inputs:{pollution:"pollution"},standalone:!0,features:[C],decls:17,vars:13,consts:[[1,"max-w-3xl","mx-auto","bg-white","rounded-2xl","shadow-lg","p-6"],[1,"flex","flex-col","md:flex-row","gap-6"],[1,"w-full","md:w-1/2","h-64","object-cover","rounded-xl","shadow",3,"src","alt"],[1,"flex-1"],[1,"text-2xl","font-bold","text-indigo-700","mb-2"],[1,"text-sm","text-gray-500","mb-2"],[1,"text-gray-600","mb-3"],[1,"text-sm","text-gray-400","italic","mb-4"],[1,"flex","gap-3"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","hover:bg-indigo-700","transition",3,"click"],["class","mt-6 border-t pt-4",4,"ngIf"],[1,"mt-6","border-t","pt-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"grid","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-semibold","text-indigo-700"],["formControlName","titre",1,"border","p-2","rounded","w-full"],["formControlName","type",1,"border","p-2","rounded","w-full"],["formControlName","description","rows","3",1,"border","p-2","rounded","w-full"],["formControlName","latitude",1,"border","p-2","rounded","w-full"],["formControlName","longitude",1,"border","p-2","rounded","w-full"],["type","submit",1,"bg-green-600","text-white","px-4","py-2","rounded-lg","hover:bg-green-700","transition"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"div",1),m(2,"img",2),r(3,"div",3)(4,"h2",4),a(5),n(),r(6,"p",5),a(7),R(8,"date"),n(),r(9,"p",6),a(10),n(),r(11,"p",7),a(12),n(),r(13,"div",8)(14,"button",9),p("click",function(){return o.toggleEdit()}),a(15),n()()()(),f(16,fi,26,1,"div",10),n()),e&2&&(s(2),u("src",o.pollution.photo,O)("alt",o.pollution.titre),s(3),x(" ",o.pollution.titre," "),s(2),F(" \u{1F4CD} ",o.pollution.lieu," \u2014 ",ee(8,10,o.pollution.date,"dd MMM yyyy")," "),s(3),x(" ",o.pollution.description," "),s(2),F(" Lat: ",o.pollution.latitude," / Long: ",o.pollution.longitude," "),s(3),x(" ",o.editMode?"\u{1F9FD} Annuler":" \u270F\uFE0F Modifier"," "),s(),u("ngIf",o.editMode))},dependencies:[E,S,ie,Te,Me,G,H,Pe,Ie,Fe]})};function gi(i,t){i&1&&(r(0,"div",6),a(1," Chargement des donn\xE9es en cours... "),n())}function hi(i,t){if(i&1&&m(0,"app-pollution-details",7),i&2){let e=c();u("pollution",e.selectedPollution)}}function vi(i,t){if(i&1){let e=w();r(0,"div",8)(1,"button",9),p("click",function(){h(e);let l=c();return v(l.closeDetails())}),a(2," \u2190 Retour \xE0 la liste "),n()()}}function xi(i,t){if(i&1){let e=w();r(0,"div",14)(1,"div",15),m(2,"img",16)(3,"div",17),r(4,"button",18),p("click",function(l){let d=h(e).$implicit,k=c(3);return v(k.toggleFavorite(d,l))}),r(5,"span",19),a(6),n()()(),r(7,"div",20)(8,"h3",21),a(9),n(),r(10,"p",22),a(11),R(12,"date"),n(),r(13,"p",23),a(14),n(),r(15,"p",24),a(16),n(),r(17,"div",25)(18,"button",26),p("click",function(){let l=h(e).$implicit,d=c(3);return v(d.viewDetails(l))}),a(19," Voir plus \u2192 "),n(),r(20,"button",27),p("click",function(){let l=h(e).$implicit,d=c(3);return v(d.deletePollution(l.id))}),a(21," \u{1F5D1}\uFE0F Supprimer "),n()()()()}if(i&2){let e=t.$implicit,o=c(3);s(2),u("src",e.photo,O)("alt",e.titre),s(2),u("title",o.isFavorite(e.id)?"Retirer des favoris":"Ajouter aux favoris"),s(2),we(o.isFavorite(e.id)?"\u2764\uFE0F":"\u{1F90D}"),s(3),x(" ",e.titre," "),s(2),F(" \u{1F4CD} ",e.lieu," \u2014 ",ee(12,10,e.date,"dd MMM yyyy")," "),s(3),x(" ",e.description," "),s(2),F(" Lat: ",e.latitude," / Long: ",e.longitude," ")}}function _i(i,t){if(i&1){let e=w();r(0,"div",28)(1,"button",29),p("click",function(){h(e);let l=c(3);return v(l.toggleView())}),a(2),n()()}if(i&2){let e=c(3);s(2),x(" ",e.showAll?"Voir moins \u2191":"Voir plus \u2193"," ")}}function bi(i,t){if(i&1&&(et(0),r(1,"div",11),f(2,xi,22,13,"div",12),n(),f(3,_i,3,1,"div",13),R(4,"async"),tt()),i&2){let e,o=t.ngIf,l=c(2);s(2),u("ngForOf",l.showAll?o:o.slice(0,l.maxVisible)),s(),u("ngIf",((e=ot(4,2,l.filteredPollutions$))==null?null:e.length)>l.maxVisible)}}function yi(i,t){i&1&&(r(0,"div",30),a(1," Aucune pollution signal\xE9e pour le moment \u{1F30D} "),n())}function wi(i,t){if(i&1&&(et(0),f(1,bi,5,4,"ng-container",10),R(2,"async"),f(3,yi,2,0,"ng-template",null,0,te),tt()),i&2){let e=ye(4),o=c();s(),u("ngIf",ot(2,2,o.filteredPollutions$))("ngIfElse",e)}}var Ge=class i{constructor(t){this.pollutionService=t}refreshTrigger=0;filterText="";pollutions$;loading=!0;selectedPollution;showAll=!1;maxVisible=4;destroy$=new _e;store=g(D);favorites=A(this.store.select(b.getFavorites),{initialValue:[]});ngOnInit(){this.loadPollutions()}ngOnChanges(t){t.refreshTrigger&&!t.refreshTrigger.firstChange&&this.loadPollutions()}loadPollutions(){this.pollutions$=this.pollutionService.pollutions$,this.pollutionService.getPollutions().subscribe(()=>{this.loading=!1})}viewDetails(t){console.log("ID de la pollution:",t.id),this.loading=!0,this.pollutionService.getPollutionById(t.id).subscribe({next:e=>{console.log("D\xE9tails re\xE7us:",e),this.selectedPollution=e,this.loading=!1},error:e=>{console.error("Erreur lors du chargement des d\xE9tails:",e),this.loading=!1,alert("Impossible de charger les d\xE9tails de la pollution. "+e.message)}})}closeDetails(){this.selectedPollution=void 0}deletePollution(t){confirm("\u274C Voulez-vous vraiment supprimer cette pollution ?")&&this.pollutionService.deletePollution(t).subscribe(()=>{this.loadPollutions()})}toggleView(){this.showAll=!this.showAll}isFavorite(t){try{let e=this.favorites();return Array.isArray(e)?e.some(o=>o.id===t):(console.warn("\u26A0\uFE0F favorites is not an array"),!1)}catch(e){return console.error("\u274C Erreur dans isFavorite:",e),!1}}toggleFavorite(t,e){e.stopPropagation(),console.log("Toggle favori pour:",t.id),this.isFavorite(t.id)?(console.log("Retirer des favoris"),this.store.dispatch(new ne({pollutionId:t.id}))):(console.log("Ajouter aux favoris"),this.store.dispatch(new Le(t)))}get filteredPollutions$(){return this.pollutions$.pipe(B(t=>t.filter(e=>e.titre.toLowerCase().includes(this.filterText)||e.lieu.toLowerCase().includes(this.filterText)||e.description.toLowerCase().includes(this.filterText))))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||i)(T($))};static \u0275cmp=y({type:i,selectors:[["app-pollutions-list"]],inputs:{refreshTrigger:"refreshTrigger",filterText:"filterText"},standalone:!0,features:[_t,C],decls:5,vars:4,consts:[["noData",""],[1,"max-w-7xl","mx-auto","px-6","py-16"],["class","text-center text-gray-500 italic",4,"ngIf"],[3,"pollution",4,"ngIf"],["class","text-center mt-6",4,"ngIf"],[4,"ngIf"],[1,"text-center","text-gray-500","italic"],[3,"pollution"],[1,"text-center","mt-6"],[1,"bg-gray-200","px-4","py-2","rounded-lg","text-gray-700","hover:bg-gray-300","transition",3,"click"],[4,"ngIf","ngIfElse"],[1,"grid","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-10"],["class","bg-white rounded-2xl shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden group relative",4,"ngFor","ngForOf"],["class","text-center mt-10",4,"ngIf"],[1,"bg-white","rounded-2xl","shadow-md","hover:shadow-xl","transition-shadow","duration-300","overflow-hidden","group","relative"],[1,"relative"],["title","Photo de pollution","onerror","this.src='assets/images/default-pollution.jpg'; this.onerror=null;",1,"w-full","h-40","object-cover","group-hover:scale-105","transition-transform","duration-500",3,"src","alt"],[1,"absolute","inset-0","bg-black/20","opacity-0","group-hover:opacity-100","transition-opacity","duration-500"],[1,"absolute","top-3","right-3","bg-white/80","hover:bg-white","rounded-full","p-2","shadow-md","hover:shadow-lg","transition-all","duration-200","z-10",3,"click","title"],[1,"text-2xl"],[1,"p-5"],[1,"text-lg","font-bold","text-indigo-700","mb-1","truncate"],[1,"text-xs","text-gray-500","mb-2","flex","items-center","gap-1"],[1,"text-gray-600","text-sm","mb-3","line-clamp-2"],[1,"text-xs","text-gray-400","mb-3","italic"],[1,"flex","justify-between","items-center"],[1,"text-sm","font-medium","text-indigo-600","hover:text-indigo-800","transition",3,"click"],[1,"text-sm","font-medium","text-red-500","hover:text-red-700","transition",3,"click"],[1,"text-center","mt-10"],[1,"bg-indigo-600","text-white","px-6","py-2","rounded-lg","shadow","hover:bg-indigo-700","transition",3,"click"],[1,"text-gray-400","text-center","mt-12","text-lg"]],template:function(e,o){e&1&&(r(0,"div",1),f(1,gi,2,0,"div",2)(2,hi,1,1,"app-pollution-details",3)(3,vi,3,0,"div",4)(4,wi,5,4,"ng-container",5),n()),e&2&&(s(),u("ngIf",o.loading),s(),u("ngIf",o.selectedPollution),s(),u("ngIf",o.selectedPollution),s(),u("ngIf",!o.selectedPollution&&!o.loading))},dependencies:[E,Se,S,Pt,ie,Ue],styles:[".favorite-icon-filled[_ngcontent-%COMP%]{filter:invert(24%) sepia(96%) saturate(1482%) hue-rotate(357deg) brightness(104%) contrast(104%)}.favorite-icon-empty[_ngcontent-%COMP%]{filter:brightness(.4)}"]})};var Qt=i=>({"border-red-500":i});function Ci(i,t){i&1&&(r(0,"span"),a(1,"\u26A0\uFE0F Le titre est requis."),n())}function Si(i,t){i&1&&(r(0,"span"),a(1,"\u26A0\uFE0F Minimum 3 caract\xE8res."),n())}function Ei(i,t){if(i&1&&(r(0,"p",35),f(1,Ci,2,0,"span",36)(2,Si,2,0,"span",36),n()),i&2){let e=c();s(),u("ngIf",e.f.titre.errors==null?null:e.f.titre.errors.required),s(),u("ngIf",e.f.titre.errors==null?null:e.f.titre.errors.minlength)}}function Pi(i,t){if(i&1&&(r(0,"div",37)(1,"p",38),a(2,"Aper\xE7u :"),n(),m(3,"img",39),n()),i&2){let e=c();s(3),u("src",e.photoPreview,O)}}var He=class i{constructor(t,e){this.fb=t;this.pollutionService=e}pollutionAdded=new Q;pollutionForm;photoPreview=null;successMessage="";formSubmitted=!1;ngOnInit(){this.pollutionForm=this.fb.group({titre:["",[_.required,_.minLength(3),_.maxLength(100)]],type:["",[_.required]],description:["",[_.required,_.minLength(10),_.maxLength(500)]],date:["",[_.required]],lieu:["",[_.required,_.minLength(3),_.maxLength(200)]],latitude:["",[_.pattern(/^[-+]?[0-9]*\.?[0-9]+$/),_.required,_.min(-90),_.max(90)]],longitude:["",[_.pattern(/^[-+]?[0-9]*\.?[0-9]+$/),_.required,_.min(-180),_.max(180)]],photo:[""]})}get f(){return this.pollutionForm.controls}sendForm(){if(this.pollutionForm.invalid)return;let t=this.pollutionForm.value,e=typeof this.photoPreview=="string"&&this.photoPreview.startsWith("data:"),o=fe.production&&e?null:this.photoPreview||t.photo,l=xe(V({},t),{id:crypto.randomUUID().substring(0,8),date:new Date(t.date),photo:o});this.pollutionService.addPollution(l).subscribe({next:d=>{console.log("\u2705 Pollution ajout\xE9e :",d),this.pollutionAdded.emit(`\u2705 Pollution "${d.titre}" d\xE9clar\xE9e avec succ\xE8s !`),this.pollutionForm.reset(),this.photoPreview=null},error:d=>console.error("Erreur ajout pollution",d)})}onPhotoSelected(t){let e=t.target.files[0];if(!e)return;let o=new FileReader;o.onload=()=>{this.photoPreview=o.result,this.pollutionForm.patchValue({photo:this.photoPreview})},o.readAsDataURL(e)}static \u0275fac=function(e){return new(e||i)(T(De),T($))};static \u0275cmp=y({type:i,selectors:[["app-pollutions-form"]],outputs:{pollutionAdded:"pollutionAdded"},standalone:!0,features:[C],decls:64,vars:10,consts:[[1,"max-w-xl","mx-auto","p-6","sm:p-8","bg-white","rounded-2xl","shadow-xl","space-y-6","border","border-gray-100","transition-all","duration-300",3,"ngSubmit","formGroup"],[1,"text-2xl","font-bold","text-center","text-indigo-700"],[1,"text-center","text-gray-500","text-sm","mb-4"],["for","titre",1,"block","text-sm","font-semibold","text-indigo-700"],["id","titre","type","text","formControlName","titre",1,"mt-1","w-full","px-3","py-2","border","rounded-lg","shadow-sm","focus:border-indigo-500","focus:ring-2","focus:ring-indigo-300","outline-none","transition",3,"ngClass"],["class","text-red-600 text-sm mt-1",4,"ngIf"],["for","type",1,"block","text-sm","font-semibold","text-indigo-700"],["id","type","formControlName","type",1,"mt-1","w-full","px-3","py-2","border","rounded-lg","shadow-sm","focus:border-indigo-500","focus:ring-2","focus:ring-indigo-300","outline-none","transition",3,"ngClass"],["value",""],["value","Plastique"],["value","Chimique"],["value","D\xE9p\xF4t sauvage"],["value","Eau"],["value","Air"],["value","Autre"],["for","description",1,"block","text-sm","font-semibold","text-indigo-700"],["id","description","formControlName","description","rows","4",1,"mt-1","w-full","px-3","py-2","border","rounded-lg","shadow-sm","focus:border-indigo-500","focus:ring-2","focus:ring-indigo-300","outline-none","transition"],["for","date",1,"block","text-sm","font-semibold","text-indigo-700"],["id","date","type","date","formControlName","date",1,"mt-1","w-full","px-3","py-2","border","rounded-lg","shadow-sm","focus:border-indigo-500","focus:ring-2","focus:ring-indigo-300","outline-none","transition"],["for","lieu",1,"block","text-sm","font-semibold","text-indigo-700"],["id","lieu","type","text","formControlName","lieu",1,"mt-1","w-full","px-3","py-2","border","rounded-lg","shadow-sm","focus:border-indigo-500","focus:ring-2","focus:ring-indigo-300","outline-none","transition"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],["for","latitude",1,"block","text-sm","font-semibold","text-indigo-700"],["id","latitude","type","number","step","any","formControlName","latitude",1,"mt-1","w-full","px-3","py-2","border","rounded-lg","shadow-sm","focus:border-indigo-500","focus:ring-2","focus:ring-indigo-300","outline-none","transition"],["for","longitude",1,"block","text-sm","font-semibold","text-indigo-700"],["id","longitude","type","number","step","any","formControlName","longitude",1,"mt-1","w-full","px-3","py-2","border","rounded-lg","shadow-sm","focus:border-indigo-500","focus:ring-2","focus:ring-indigo-300","outline-none","transition"],[1,"block","text-sm","font-semibold","text-indigo-700","mb-2"],["type","url","formControlName","photo","placeholder","https://...",1,"block","w-full","text-sm","text-gray-700","border","border-gray-300","rounded-lg","p-2","focus:ring-2","focus:ring-indigo-400","outline-none","transition","mb-3"],[1,"flex","flex-col","sm:flex-row","gap-3"],[1,"flex-1","cursor-pointer","bg-gradient-to-r","from-indigo-600","to-blue-500","text-white","text-center","py-2","rounded-xl","shadow-lg","hover:scale-[1.02]","transition-transform"],["type","file","accept","image/*",1,"hidden",3,"change"],[1,"flex-1","cursor-pointer","bg-gradient-to-r","from-green-600","to-teal-500","text-white","text-center","py-2","rounded-xl","shadow-lg","hover:scale-[1.02]","transition-transform"],["type","file","accept","image/*","capture","environment",1,"hidden",3,"change"],["class","mt-4 text-center",4,"ngIf"],["type","submit",1,"w-full","bg-gradient-to-r","from-blue-600","via-indigo-600","to-purple-600","text-white","font-semibold","py-3","px-4","rounded-xl","shadow-lg","hover:opacity-90","focus:outline-none","focus:ring-2","focus:ring-indigo-400","transition","disabled:opacity-60","disabled:cursor-not-allowed",3,"disabled"],[1,"text-red-600","text-sm","mt-1"],[4,"ngIf"],[1,"mt-4","text-center"],[1,"text-sm","text-gray-500","mb-1"],["alt","Pr\xE9visualisation",1,"w-full","h-48","object-cover","rounded-lg","shadow-md","border","border-gray-200",3,"src"]],template:function(e,o){e&1&&(r(0,"form",0),p("ngSubmit",function(){return o.sendForm()}),r(1,"h2",1),a(2,"D\xE9clarer une pollution \u{1F30D}"),n(),r(3,"p",2),a(4," Merci de nous aider \xE0 signaler une pollution et prot\xE9ger l\u2019environnement "),n(),r(5,"div")(6,"label",3),a(7,"Titre"),n(),m(8,"input",4),f(9,Ei,3,2,"p",5),n(),r(10,"div")(11,"label",6),a(12,"Type"),n(),r(13,"select",7)(14,"option",8),a(15,"-- S\xE9lectionnez --"),n(),r(16,"option",9),a(17,"Plastique"),n(),r(18,"option",10),a(19,"Chimique"),n(),r(20,"option",11),a(21,"D\xE9p\xF4t sauvage"),n(),r(22,"option",12),a(23,"Eau"),n(),r(24,"option",13),a(25,"Air"),n(),r(26,"option",14),a(27,"Autre"),n()()(),r(28,"div")(29,"label",15),a(30,"Description"),n(),m(31,"textarea",16),n(),r(32,"div")(33,"label",17),a(34,"Date"),n(),m(35,"input",18),n(),r(36,"div")(37,"label",19),a(38,"Lieu"),n(),m(39,"input",20),n(),r(40,"div",21)(41,"div")(42,"label",22),a(43,"Latitude"),n(),m(44,"input",23),n(),r(45,"div")(46,"label",24),a(47,"Longitude"),n(),m(48,"input",25),n()(),r(49,"div")(50,"label",26),a(51,"Photo"),n(),m(52,"input",27),r(53,"div",28)(54,"label",29),a(55," \u{1F4C1} Depuis l\u2019ordinateur "),r(56,"input",30),p("change",function(d){return o.onPhotoSelected(d)}),n()(),r(57,"label",31),a(58," \u{1F4F7} Prendre une photo "),r(59,"input",32),p("change",function(d){return o.onPhotoSelected(d)}),n()()(),f(60,Pi,4,1,"div",33),n(),r(61,"div")(62,"button",34),a(63," \u{1F680} D\xE9clarer "),n()()()),e&2&&(u("formGroup",o.pollutionForm),s(8),u("ngClass",me(6,Qt,o.f.titre.touched&&o.f.titre.invalid)),s(),u("ngIf",o.f.titre.touched&&o.f.titre.invalid),s(4),u("ngClass",me(8,Qt,o.f.type.touched&&o.f.type.invalid)),s(47),u("ngIf",o.photoPreview),s(2),u("disabled",o.pollutionForm.invalid))},dependencies:[Te,Me,Lt,Vt,G,At,Nt,H,Pe,Ie,Fe,E,Ce,S]})};var ki=["declareFormSection"];function Mi(i,t){if(i&1&&(r(0,"div",21),a(1),n()),i&2){let e=c();s(),x(" ",e.successMessage,`
`)}}function Ii(i,t){if(i&1){let e=w();r(0,"section",16,0)(2,"div",22)(3,"app-pollutions-form",23),p("pollutionAdded",function(l){h(e);let d=c();return v(d.onPollutionAdded(l))}),n()()()}}var ze=class i{showForm=!1;successMessage="";refreshKey=0;searchText="";pendingScroll=!1;declareFormSection;toggleForm(){this.showForm=!this.showForm,this.showForm&&(this.pendingScroll=!0)}ngAfterViewChecked(){this.pendingScroll&&this.declareFormSection&&(this.declareFormSection.nativeElement.scrollIntoView({behavior:"smooth",block:"start"}),this.pendingScroll=!1)}onPollutionAdded(t){this.successMessage=t,this.refreshKey++,setTimeout(()=>{this.successMessage="",this.showForm=!1},3e3)}onSearchChanged(t){this.searchText=t}scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}onGoHome(){this.showForm=!1,window.scrollTo({top:0,behavior:"smooth"})}onOpenDeclareForm(){this.showForm||(this.showForm=!0),setTimeout(()=>{this.declareFormSection?.nativeElement.scrollIntoView({behavior:"smooth",block:"start"})},0)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-pollution"]],viewQuery:function(e,o){if(e&1&&wt(ki,5),e&2){let l;Ct(l=St())&&(o.declareFormSection=l.first)}},standalone:!0,features:[C],decls:27,vars:5,consts:[["declareFormSection",""],[1,"mb-1"],[3,"searchChanged","goHome","openDeclareForm","declareActive"],[1,"relative","w-full","bg-gradient-to-br","from-indigo-600","via-blue-600","to-green-500","text-white","py-20","md:py-28","overflow-hidden"],[1,"container","mx-auto","flex","flex-col","md:flex-row","items-center","justify-between","px-6","md:px-16"],[1,"max-w-lg","text-center","md:text-left","space-y-5","z-10"],[1,"text-4xl","md:text-5xl","font-extrabold","leading-tight","drop-shadow-lg"],[1,"block","md:inline","text-green-200"],[1,"text-gray-100","text-lg","max-w-md","mx-auto","md:mx-0"],[1,"mt-4","bg-white","text-indigo-700","font-semibold","px-6","py-3","rounded-lg","shadow-lg","transition-all","duration-300","ease-out","transform","hover:-translate-y-1","hover:scale-105","hover:bg-indigo-50","hover:text-indigo-800","hover:shadow-[0_0_20px_rgba(99,102,241,0.6)]","active:scale-95",3,"click"],[1,"relative","flex","justify-center","md:justify-end","w-full","md:w-1/2","mt-10","md:mt-0"],[1,"absolute","inset-0","bg-gradient-to-t","from-indigo-600/30","via-transparent","to-transparent","rounded-full","blur-3xl"],["src","assets/terre.png","alt","illustration pollution",1,"relative","z-10","max-h-[300px]","md:max-h-[380px]","object-contain","drop-shadow-2xl","rounded-2xl","bg-white/10","p-4","backdrop-blur-sm","transition-transform","duration-500","hover:scale-105"],[1,"absolute","bottom-0","left-0","w-full","h-24","bg-gradient-to-t","from-white","to-transparent"],["class","max-w-3xl mx-auto mt-10 px-6 py-4 bg-green-100 text-green-800 border border-green-300 rounded-lg text-center font-semibold shadow-md animate-fade-in-down",4,"ngIf"],["class","bg-gray-50 py-16",4,"ngIf"],[1,"bg-gray-50","py-16"],[1,"max-w-7xl","mx-auto","px-6"],[1,"text-2xl","md:text-3xl","font-extrabold","text-center","text-indigo-700","mb-12","flex","flex-col","items-center","justify-center","gap-2"],[1,"text-3xl","md:text-4xl"],[3,"refreshTrigger","filterText"],[1,"max-w-3xl","mx-auto","mt-10","px-6","py-4","bg-green-100","text-green-800","border","border-green-300","rounded-lg","text-center","font-semibold","shadow-md","animate-fade-in-down"],[1,"max-w-3xl","mx-auto","px-6","bg-white","rounded-2xl","shadow-md","p-8"],[3,"pollutionAdded"]],template:function(e,o){e&1&&(r(0,"div",1)(1,"app-header",2),p("searchChanged",function(d){return o.onSearchChanged(d)})("goHome",function(){return o.scrollToTop()})("openDeclareForm",function(){return o.onOpenDeclareForm()}),n()(),r(2,"section",3)(3,"div",4)(4,"div",5)(5,"h1",6),a(6," Prot\xE9geons notre "),r(7,"span",7),a(8,"plan\xE8te ensemble \u{1F30D}"),n()(),r(9,"p",8),a(10," Signalez, suivez et agissez contre les pollutions autour de vous. "),n(),r(11,"button",9),p("click",function(){return o.toggleForm()}),a(12," \u{1F680} D\xE9clarer une pollution "),n()(),r(13,"div",10),m(14,"div",11)(15,"img",12),n()(),m(16,"div",13),n(),f(17,Mi,2,1,"div",14)(18,Ii,4,0,"section",15),r(19,"section",16)(20,"div",17)(21,"h2",18)(22,"span",19),a(23,"\u{1F33F}"),n(),r(24,"span"),a(25,"Derni\xE8res pollutions signal\xE9es"),n()(),m(26,"app-pollutions-list",20),n()()),e&2&&(s(),u("declareActive",o.showForm),s(16),u("ngIf",o.successMessage),s(),u("ngIf",o.showForm),s(8),u("refreshTrigger",o.refreshKey)("filterText",o.searchText))},dependencies:[re,Ge,He,E,S],styles:["section[ng-reflect-ng-if][_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.animate-fade-in-down[_ngcontent-%COMP%]{animation:fadeInDown .5s ease-out}"]})};function Fi(i,t){if(i&1&&(r(0,"p",17),a(1),n()),i&2){let e=c();s(),x(" ",e.message," ")}}var $e=class i{constructor(t,e){this.utilisateurService=t;this.router=e}user;email="";mot_de_passe="";message="";showPassword=!1;ngOnInit(){this.user||(this.user=this.utilisateurService.getCurrentUser()),this.user?this.email=this.user.email:this.message="\u26A0\uFE0F Aucun utilisateur connect\xE9."}onUpdate(){if(!this.user){this.message="Utilisateur introuvable.";return}this.utilisateurService.updateUtilisateur(this.user.id,{email:this.email,mot_de_passe:this.mot_de_passe.trim()||void 0}).subscribe({next:()=>{this.message="\u2705 Profil mis \xE0 jour avec succ\xE8s.",this.mot_de_passe=""},error:t=>{this.message="\u274C Erreur lors de la mise \xE0 jour.",console.error(t)}})}onDelete(){if(!this.user){this.message="Utilisateur introuvable.";return}confirm("Voulez-vous vraiment supprimer votre compte ? Cette action est irr\xE9versible.")&&this.utilisateurService.deleteUtilisateur(this.user.id).subscribe({next:()=>ae(this,null,function*(){alert("Compte supprim\xE9 avec succ\xE8s."),this.utilisateurService.logout(),yield this.router.navigate(["/login"])}),error:t=>{alert("Erreur lors de la suppression du compte."),console.error(t)}})}static \u0275fac=function(e){return new(e||i)(T(Kt),T(U))};static \u0275cmp=y({type:i,selectors:[["app-profil"]],inputs:{user:"user"},standalone:!0,features:[C],decls:27,vars:5,consts:[[1,"min-h-screen","flex","flex-col","items-center","justify-center","bg-gradient-to-br","from-blue-600","via-indigo-600","to-purple-700","p-6"],["routerLink","/",1,"flex","items-center","gap-2","mb-6","text-indigo-100","hover:text-white","font-medium","bg-white/10","hover:bg-white/20","px-4","py-2","rounded-full","border","border-white/30","backdrop-blur-md","shadow","transition-all","duration-300"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M15 19l-7-7 7-7"],[1,"bg-white/95","backdrop-blur-xl","p-8","rounded-2xl","shadow-2xl","w-full","max-w-md","space-y-6","border","border-white/20"],[1,"text-2xl","font-bold","text-center","text-indigo-700"],[1,"text-center","text-gray-500","text-sm"],[1,"block"],[1,"text-gray-700","font-medium"],["type","email",1,"w-full","mt-1","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-400","outline-none","transition",3,"ngModelChange","ngModel"],["placeholder","Laisser vide pour ne pas changer",1,"w-full","mt-1","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-400","outline-none","transition",3,"ngModelChange","type","ngModel"],[1,"flex","items-center","text-sm","mt-2","cursor-pointer","text-gray-600"],["type","checkbox",1,"mr-2","rounded","text-indigo-600",3,"ngModelChange","ngModel"],[1,"space-y-3","pt-2"],[1,"w-full","bg-indigo-600","hover:bg-indigo-700","text-white","py-2.5","rounded-lg","font-semibold","shadow-md","transition",3,"click"],[1,"w-full","bg-red-600","hover:bg-red-700","text-white","py-2.5","rounded-lg","font-semibold","shadow-md","transition",3,"click"],["class","text-center text-sm text-gray-600 mt-3",4,"ngIf"],[1,"text-center","text-sm","text-gray-600","mt-3"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"button",1),be(),r(2,"svg",2),m(3,"path",3),n(),a(4," Retour \xE0 l\u2019accueil "),n(),bt(),r(5,"div",4)(6,"h2",5),a(7,"Mon profil"),n(),r(8,"p",6),a(9," G\xE9rez vos informations personnelles et s\xE9curisez votre compte \u{1F510} "),n(),r(10,"label",7)(11,"span",8),a(12,"Email"),n(),r(13,"input",9),Z("ngModelChange",function(d){return X(o.email,d)||(o.email=d),d}),n()(),r(14,"label",7)(15,"span",8),a(16,"Nouveau mot de passe"),n(),r(17,"input",10),Z("ngModelChange",function(d){return X(o.mot_de_passe,d)||(o.mot_de_passe=d),d}),n(),r(18,"label",11)(19,"input",12),Z("ngModelChange",function(d){return X(o.showPassword,d)||(o.showPassword=d),d}),n(),a(20," Afficher le mot de passe "),n()(),r(21,"div",13)(22,"button",14),p("click",function(){return o.onUpdate()}),a(23," Mettre \xE0 jour "),n(),r(24,"button",15),p("click",function(){return o.onDelete()}),a(25," Supprimer mon compte "),n()(),f(26,Fi,2,1,"p",16),n()()),e&2&&(s(13),J("ngModel",o.email),s(4),u("type",o.showPassword?"text":"password"),J("ngModel",o.mot_de_passe),s(2),J("ngModel",o.showPassword),s(7),u("ngIf",o.message))},dependencies:[E,S,Oe,G,Tt,H,ke,oe],styles:["[_nghost-%COMP%]{display:block;animation:_ngcontent-%COMP%_fadeIn .4s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}"]})};function Di(i,t){if(i&1){let e=w();r(0,"div",15)(1,"div",16),m(2,"img",17)(3,"div",18),r(4,"button",19),p("click",function(l){let d=h(e).$implicit,k=c(2);return v(k.removeFavorite(d.id,l))}),m(5,"img",20),n()(),r(6,"div",21)(7,"h3",22),a(8),n(),r(9,"p",23),a(10),R(11,"date"),n(),r(12,"p",24),a(13),n(),r(14,"p",25),a(15),n(),r(16,"button",26),a(17," Voir plus \u2192 "),n()()()}if(i&2){let e=t.$implicit;s(2),u("src",e.photo,O)("alt",e.titre),s(6),x(" ",e.titre," "),s(2),F(" \u{1F4CD} ",e.lieu," \u2014 ",ee(11,8,e.date,"dd MMM yyyy")," "),s(3),x(" ",e.description," "),s(2),F(" Lat: ",e.latitude," / Long: ",e.longitude," ")}}function Oi(i,t){if(i&1){let e=w();r(0,"div")(1,"div",10)(2,"h2",11),a(3,"Mes pollutions favorites"),n(),r(4,"button",12),p("click",function(){h(e);let l=c();return v(l.clearAllFavorites())}),a(5," \u{1F5D1}\uFE0F Vider tous les favoris "),n()(),r(6,"div",13),f(7,Di,18,11,"div",14),n()()}if(i&2){let e=c();s(7),u("ngForOf",e.favorites())}}function Ti(i,t){if(i&1){let e=w();r(0,"div",27)(1,"div",28),a(2,"\u{1F914}"),n(),r(3,"h2",29),a(4,"Pas encore de favoris"),n(),r(5,"p",30),a(6," Ajoutez des pollutions \xE0 vos favoris en cliquant sur le \u{1F90D} blanc en haut \xE0 droite des cartes. "),n(),r(7,"button",31),p("click",function(){h(e);let l=c();return v(l.goHome())}),a(8," \u2190 Retour \xE0 l'accueil "),n()()}}var Be=class i{store=g(D);router=g(U);favorites=A(this.store.select(b.getFavorites),{initialValue:[]});ngOnInit(){}removeFavorite(t,e){e.stopPropagation(),this.store.dispatch(new ne({pollutionId:t}))}clearAllFavorites(){confirm("\u26A0\uFE0F Voulez-vous vraiment supprimer TOUS vos favoris ?")&&this.store.dispatch(new Ve)}goHome(){this.router.navigate(["/"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-favorites"]],standalone:!0,features:[C],decls:14,vars:3,consts:[["noFavorites",""],[1,"mb-1"],[1,"relative","w-full","bg-gradient-to-br","from-red-500","via-pink-500","to-rose-400","text-white","py-20"],[1,"container","mx-auto","px-6","text-center"],[1,"text-4xl","md:text-5xl","font-extrabold","drop-shadow-lg"],[1,"text-gray-100","text-lg","mt-3"],[1,"absolute","bottom-0","left-0","w-full","h-24","bg-gradient-to-t","from-white","to-transparent"],[1,"bg-gray-50","py-16"],[1,"max-w-7xl","mx-auto","px-6"],[4,"ngIf","ngIfElse"],[1,"flex","justify-between","items-center","mb-8"],[1,"text-2xl","font-bold","text-indigo-700"],[1,"bg-red-500","hover:bg-red-600","text-white","px-4","py-2","rounded-lg","font-semibold","transition",3,"click"],[1,"grid","sm:grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-10"],["class","bg-white rounded-2xl shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden group relative",4,"ngFor","ngForOf"],[1,"bg-white","rounded-2xl","shadow-md","hover:shadow-xl","transition-shadow","duration-300","overflow-hidden","group","relative"],[1,"relative"],["onerror","this.src='assets/images/default-pollution.jpg'; this.onerror=null;","title","Photo de la pollution",1,"w-full","h-40","object-cover","group-hover:scale-105","transition-transform","duration-500",3,"src","alt"],[1,"absolute","inset-0","bg-black/20","opacity-0","group-hover:opacity-100","transition-opacity","duration-500"],["title","Retirer des favoris",1,"absolute","top-3","right-3","bg-white/80","hover:bg-white","rounded-full","p-2","shadow-md","hover:shadow-lg","transition-all","duration-200","z-10",3,"click"],["src","assets/images/favorite.svg","alt","Retirer des favoris","title","Retirer des favoris",1,"w-6","h-6","favorite-icon-filled"],[1,"p-5"],[1,"text-lg","font-bold","text-indigo-700","mb-1","truncate"],[1,"text-xs","text-gray-500","mb-2","flex","items-center","gap-1"],[1,"text-gray-600","text-sm","mb-3","line-clamp-2"],[1,"text-xs","text-gray-400","mb-3","italic"],[1,"text-sm","font-medium","text-indigo-600","hover:text-indigo-800","transition"],[1,"text-center","py-16"],[1,"text-6xl","mb-4"],[1,"text-2xl","font-bold","text-gray-700","mb-4"],[1,"text-gray-500","text-lg","mb-8"],[1,"bg-indigo-600","hover:bg-indigo-700","text-white","px-6","py-3","rounded-lg","font-semibold","transition",3,"click"]],template:function(e,o){if(e&1&&(r(0,"div",1),m(1,"app-header"),n(),r(2,"section",2)(3,"div",3)(4,"h1",4),a(5," \u2764\uFE0F Mes Favoris "),n(),r(6,"p",5),a(7),n()(),m(8,"div",6),n(),r(9,"section",7)(10,"div",8),f(11,Oi,8,1,"div",9)(12,Ti,9,0,"ng-template",null,0,te),n()()),e&2){let l=ye(13);s(7),x(" ",o.favorites().length," pollution(s) sauvegard\xE9e(s) "),s(4),u("ngIf",o.favorites().length>0)("ngIfElse",l)}},dependencies:[E,Se,S,ie,re],styles:[".favorite-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px)}button[_ngcontent-%COMP%]:hover{filter:brightness(1.1)}"]})};var dt=(i,t)=>{let e=g(D),o=g(U);return e.selectSnapshot(N.isConnected)?!0:(console.warn("\u26A0\uFE0F Acc\xE8s refus\xE9 : utilisateur non connect\xE9"),o.navigate(["/login"]),!1)};var Jt=[{path:"",component:ze},{path:"profil",component:$e,canActivate:[dt]},{path:"favoris",component:Be,canActivate:[dt]},{path:"login",loadComponent:()=>import("./chunk-FGYFXLZ5.js").then(i=>i.LoginComponent)},{path:"signup",loadComponent:()=>import("./chunk-4BONOK3R.js").then(i=>i.SignupComponent)},{path:"**",redirectTo:""}];var ut="@@STATE",We=new Y(""),Xt=new Y("",{providedIn:"root",factory:()=>g(We).keys==="*"}),ge=new Y(""),ct=new Y("");function mt(i){return i!=null&&!!i.engine}function Zt(i){return mt(i)&&(i=i.key),i.hasOwnProperty(rt)&&(i=i[rt].name),i instanceof jt?i.getName():i}function Ai(i){return xe(V({storage:0,serialize:JSON.stringify,deserialize:JSON.parse,beforeSerialize:t=>t,afterDeserialize:t=>t},i),{keys:i.keys==="*"?[ut]:i.keys})}function Ni(i,t){return nt(t)?null:i.storage===0?localStorage:i.storage===1?sessionStorage:null}function ei(i,t){return t?.namespace?`${t.namespace}:${i}`:i}var Li=(()=>{class i{constructor(){this._keys=new Set,this._injector=g(yt),this._keysWithEngines=[];let{keys:e}=g(ge);this.addKeys(e)}getKeysWithEngines(){return[...this._keysWithEngines]}addKeys(e){for(let o of e){let l=Zt(o);if(this._keys.has(l))continue;this._keys.add(l);let d=mt(o)?this._injector.get(o.engine):this._injector.get(ct);this._keysWithEngines.push({key:l,engine:d})}}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=ce({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Vi=(()=>{class i{constructor(){this._keysManager=g(Li),this._options=g(ge),this._allStatesPersisted=g(Xt),this._isServer=nt(g(Xe))}handle(e,o,l){if(this._isServer)return l(e,o);let d=Gt(o),k=d(Rt),le=d(Ut),qe=k||le,he=!1;if(qe){let q=le&&o.addedStates;for(let{key:I,engine:Ye}of this._keysManager.getKeysWithEngines()){if(!this._allStatesPersisted&&q){let M=I.indexOf(ji),Qe=M>-1?I.slice(0,M):I;if(!q.hasOwnProperty(Qe))continue}let ve=ei(I,this._options),P=Ye.getItem(ve);if(P!=="undefined"&&P!=null){try{let M=this._options.deserialize(P);P=this._options.afterDeserialize(M,I)}catch{P={}}this._options.migrations?.forEach(M=>{let Qe=M.version===lt(P,M.versionKey||"version"),oi=!M.key&&this._allStatesPersisted||M.key===I;Qe&&oi&&(P=M.migrate(P),he=!0)}),this._allStatesPersisted?(P=this._hydrateSelectivelyOnUpdate(P,q),e=V(V({},e),P)):e=Ht(e,I,P)}}}return l(e,o).pipe(ue(q=>{if(!(qe&&!he))for(let{key:I,engine:Ye}of this._keysManager.getKeysWithEngines()){let ve=q,P=ei(I,this._options);I!==ut&&(ve=lt(q,I));try{let M=this._options.beforeSerialize(ve,I);Ye.setItem(P,this._options.serialize(M))}catch{}}}))}_hydrateSelectivelyOnUpdate(e,o){return!e||!o||Object.keys(o).length===0?e:Object.keys(o).reduce((l,d)=>(e.hasOwnProperty(d)&&(l[d]=e[d]),l),{})}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=ce({token:i,factory:i.\u0275fac})}}return i})(),ji=".",ti=(()=>{class i{static forRoot(e){return{ngModule:i,providers:[Bt(Vi),{provide:We,useValue:e},{provide:ge,useFactory:Ai,deps:[We]},{provide:ct,useFactory:Ni,deps:[ge,Xe]}]}}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=vt({type:i})}static{this.\u0275inj=gt({})}}return i})();var Ri={developmentMode:!0,selectorOptions:{suppressErrors:!1,injectContainerState:!1}},ii={providers:[Et({eventCoalescing:!0}),Ot(Jt),Mt(),xt(zt.forRoot([N,b],Ri),ti.forRoot({keys:["auth","favorites"]}))]};var Ke=class i{title="Pollution";store=g(D);ngOnInit(){this.store.dispatch(new Ne),this.store.dispatch(new je)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-root"]],standalone:!0,features:[C],decls:1,vars:0,template:function(e,o){e&1&&m(0,"router-outlet")},dependencies:[Ft]})};It(Ke,ii).catch(i=>console.error(i));
